<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»Šã®è¨˜éŒ² | é£Ÿè–¬AI</title>
    <style>
        :root { --main: #4a6741; --bg: #fdfaf1; --plus: #e8f5e9; --minus: #fff3e0; --error: #e74c3c; }
        body { font-family: "Hiragino Sans", sans-serif; background: var(--bg); padding: 15px; color: #333; line-height: 1.6; }
        .container { max-width: 550px; margin: auto; background: white; padding: 25px; border-radius: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        
        /* ç´¯è¨ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¼·èª¿ */
        .alert-box { background: #fff5f5; border: 3px solid var(--error); padding: 15px; border-radius: 20px; text-align: center; margin-bottom: 25px; }
        .alert-box b { color: var(--error); font-size: 1.3rem; display: block; margin-bottom: 5px; }
        .alert-box p { margin: 0; font-weight: bold; color: #333; }

        .char-box { text-align: center; background: #f9fbf8; padding: 15px; border-radius: 30px; border: 2px solid #eef2ed; margin-bottom: 20px; }
        .char-img { font-size: 70px; }
        h1 { color: var(--main); text-align: center; font-size: 1.6rem; margin: 10px 0; }

        label { font-weight: bold; color: var(--main); display: block; margin: 25px 0 8px; font-size: 1.3rem; }
        select, input[type="range"] { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #eee; font-size: 1.2rem; margin-bottom: 12px; box-sizing: border-box; background: #fff; }
        
        /* å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæ¨™æº–å¯¾å¿œï¼‰ */
        .file-upload-label { background: #f0f4ee; border: 3px dashed var(--main); padding: 25px; border-radius: 20px; text-align: center; cursor: pointer; display: block; }
        .file-upload-label span { font-size: 2.5rem; display: block; }
        .file-upload-label p { margin: 10px 0 0; font-weight: bold; color: var(--main); }
        input[type="file"] { display: none; }

        /* 14å•ã®è³ªå•ã‚’è©³ã—ãï¼ˆã‚½ãƒ¼ã‚¹æº–æ‹ ï¼‰ */
        .section-tag { font-size: 1.1rem; font-weight: bold; padding: 8px 15px; border-radius: 8px; margin-top: 30px; display: inline-block; color: white; }
        .plus-tag { background: var(--main); }
        .minus-tag { background: var(--error); }
        .q-card { padding: 18px; margin: 10px 0; border-radius: 20px; border: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .q-text { flex: 1; font-size: 1.2rem; font-weight: bold; }
        .q-sub { font-size: 0.9rem; color: #666; font-weight: normal; display: block; margin-top: 3px; }
        .q-check { width: 45px; height: 45px; transform: scale(1.8); accent-color: var(--main); }

        .btn-submit { background: var(--main); color: white; width: 100%; padding: 25px; border-radius: 20px; border: none; font-weight: bold; font-size: 1.6rem; cursor: pointer; margin-top: 40px; box-shadow: 0 10px 25px rgba(74,103,65,0.3); }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="loading" class="loading-overlay">
        <div style="font-size: 80px;">ğŸ¦</div>
        <p style="font-weight: bold; color: #4a6741; font-size: 1.5rem; margin-top: 20px;">AIãŒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æº–å‚™ä¸­...</p>
    </div>

    <div class="container">
        <div class="alert-box">
            <b>ğŸ“¢ é£Ÿã¹ãŸãã®éƒ½åº¦ç™»éŒ²ã—ã¦ãã ã•ã„ï¼</b>
            <p>ä¸€æ—¥åˆ†ã¨ã—ã¦ç´¯è¨ˆè¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <div class="char-box">
            <span class="char-img">ğŸ¦</span>
            <h1>ä»Šã®é£Ÿè–¬è¨˜éŒ²</h1>
        </div>

        <form id="dailyForm">
            <label>ğŸ½ï¸ ä»Šã®é£Ÿäº‹ã®ç›®çš„</label>
            <select name="meal_purpose" required>
                <option value="health">ä½“ã‚’æ•´ãˆã‚‹ï¼ˆå¥åº·ï¼‰</option>
                <option value="enjoy">æ™‚é–“ã‚’æ¥½ã—ã‚€ï¼ˆå¹¸ç¦ï¼‰</option>
                <option value="social">äººã¨éã”ã™ï¼ˆäº¤æµï¼‰</option>
            </select>

            <label>ğŸ“¸ å†™çœŸï¼ˆé£Ÿäº‹ãƒ»èˆŒãªã©ï¼‰</label>
            <label class="file-upload-label">
                <span>ğŸ“·</span>
                <p>ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’æ’®å½±ãƒ»é¸æŠ</p>
                <!-- captureå±æ€§ã¯ä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ç„¡è¦–ã•ã‚Œã¾ã™ãŒã€æ¨™æº–ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã§ä»£ç”¨å¯èƒ½ã§ã™ -->
                <input type="file" name="photos" accept="image/*" multiple required onchange="document.getElementById('fileStat').innerText = this.files.length + 'æšé¸æŠæ¸ˆ'">
                <div id="fileStat" style="margin-top:10px; font-weight:bold; color:var(--main);"></div>
            </label>

            <!-- 14å•ã®è³ªå•ï¼šã‚½ãƒ¼ã‚¹[1, 2]ã‚’è©³ã—ãå…·ä½“åŒ– -->
            <div class="section-tag plus-tag">âœ¨ ä½“ã‚’æ•´ãˆã‚‹ç¿’æ…£ï¼ˆåŠ ç‚¹ï¼‰</div>
            <div id="plusQs"></div>
            <div class="section-tag minus-tag">âš ï¸ è² æ‹…ã‚’ã‹ã‘ãŸç¿’æ…£ï¼ˆæ¸›ç‚¹ï¼‰</div>
            <div id="minusQs"></div>

            <label>ğŸš½ ä¾¿ãƒ»å°¿ãƒ»ç¡çœ ã®ãƒã‚§ãƒƒã‚¯ï¼ˆ5æ®µéšï¼‰</label>
            
            <p style="margin:15px 0 5px; font-weight:bold;">ğŸ’© ä¾¿ã®çŠ¶æ…‹ï¼ˆå›æ•°ãƒ»è³ªï¼‰</p>
            <select name="stool_state" required>
                <option value="5">5ï¼šéå¸¸ã«ã‚¹ãƒƒã‚­ãƒªï¼ˆç†æƒ³çš„ãƒ»ãƒãƒŠãƒŠçŠ¶ï¼‰</option>
                <option value="4">4ï¼šæ¦‚ã­è‰¯å¥½ï¼ˆæ¯æ—¥å‡ºã¦ã„ã‚‹ï¼‰</option>
                <option value="3" selected>3ï¼šæ™®é€š</option>
                <option value="2">2ï¼šã‚„ã‚„ä¸èª¿ï¼ˆç¡¬ã„ãƒ»ç·©ã„ãƒ»å›æ•°ä¸è¶³ï¼‰</option>
                <option value="1">1ï¼šã‹ãªã‚Šä¸èª¿ï¼ˆä¾¿ç§˜ãƒ»ä¸‹ç—¢ï¼‰</option>
            </select>

            <p style="margin:15px 0 5px; font-weight:bold;">ğŸ’§ å°¿ã®çŠ¶æ…‹ï¼ˆå›æ•°ãƒ»é‡ãƒ»è‰²ï¼‰</p>
            <select name="urine_state" required>
                <option value="5">5ï¼šé€ãé€šã£ãŸæ·¡é»„è‰²ï¼ˆæ°´åˆ†å……å®Ÿï¼‰ã€æ®‹å°¿æ„Ÿãªã—</option>
                <option value="4">4ï¼šé€ãé€šã£ãŸé»„è‰²ï¼ˆæ¦‚ã­è‰¯å¥½ï¼‰</option>
                <option value="3" selected>3ï¼šå°‘ã—é»„è‰²ãŒæ¿ƒãé‡å°‘ãªã„ï¼ˆæ°´åˆ†ä¸è¶³ãã¿ï¼‰</option>
                <option value="2">2ï¼šæ¿ƒã„é»„è‰²ãƒ»å›æ•°ãŒå¤šã„/å°‘ãªã„</option>
                <option value="1">1ï¼šæ¿ã‚Šã€ã«ãŠã„ã€ç—›ã¿ãŒã‚ã‚‹</option>
            </select>

            <p style="margin:15px 0 5px; font-weight:bold;">ğŸ˜´ ç¡çœ ï¼ˆæ™‚é–“ãƒ»è³ªï¼‰</p>
            <select name="sleep_quality" required>
                <option value="5">5ï¼š7æ™‚é–“ä»¥ä¸Šãƒ»ç†Ÿç¡ã§ããŸï¼ˆæœ€é«˜ï¼‰</option>
                <option value="4">4ï¼š6æ™‚é–“ä»¥ä¸Šãƒ»æ¦‚ã­ã‚ˆãçœ ã‚ŒãŸ</option>
                <option value="3" selected>3ï¼š6æ™‚é–“ç¨‹åº¦ãƒ»æ™®é€š</option>
                <option value="2">2ï¼š5æ™‚é–“æœªæº€ãƒ»ã¾ãŸã¯ä½•åº¦ã‚‚ç›®ãŒè¦šã‚ãŸ</option>
                <option value="1">1ï¼š4æ™‚é–“æœªæº€ãƒ»è‘—ã—ã„ä¸è¶³ã¾ãŸã¯å…¨ãçœ ã‚Œãš</option>
            </select>

            <label>ğŸŒ¡ï¸ ä»Šã®çŠ¶æ…‹ï¼ˆå„10æ®µéšï¼‰</label>
            <p style="margin:0; font-size:1rem;">å¿ƒã®çŠ¶æ…‹ (1:æ‚ªã„ ã€œ 10:è‰¯ã„)</p>
            <input type="range" name="mind_state" min="1" max="10" value="5">
            <p style="margin:15px 0 0; font-size:1rem;">ä½“ã®çŠ¶æ…‹ (1:æ‚ªã„ ã€œ 10:è‰¯ã„)</p>
            <input type="range" name="body_state" min="1" max="10" value="5">

            <button type="submit" class="btn-submit">è¨˜éŒ²ã‚’é€ä¿¡ã—ã¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã‚‚ã‚‰ãŠã†ï¼</button>
        </form>
    </div>

    <script>
        const userId = new URLSearchParams(window.location.search).get('user_id') || "U12345";
        
        // ã‚½ãƒ¼ã‚¹ã«åŸºã¥ã„ãŸè©³ç´°ãªç¿’æ…£14å• [1-3]
        const plusList = [
            {id:1, t:"ã‚¿ãƒãƒ»ãƒŠãƒƒãƒ„ï¼ˆ5gç¨‹åº¦ï¼‰", s:"ã”ã¾ã‚„ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ãªã©ã‚’é£Ÿã¹ãŸ"},
            {id:2, t:"é‡èœï¼ˆç‰‡æ‰‹ã®ã²ã‚‰åˆ†ä»¥ä¸Šï¼‰", s:"æ¯é£Ÿã€ç”Ÿé‡èœã‚„æ¸©é‡èœã‚’æ„è­˜ã—ã¦é£Ÿã¹ãŸ"},
            {id:3, t:"æ—¬ã®é‡èœã‚’é£Ÿã¹ãŸ", s:"å­£ç¯€ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å–ã‚Šå…¥ã‚ŒãŸ"},
            {id:4, t:"æµ·è—»é¡ï¼ˆã‚ã‹ã‚ãƒ»æ˜†å¸ƒç­‰ï¼‰", s:"ãƒŸãƒãƒ©ãƒ«è±Šå¯Œãªæµ·è—»ã‚’ç‰‡æ‰‹åˆ†é£Ÿã¹ãŸ"},
            {id:5, t:"ã‚­ãƒã‚³é¡ã‚’é£Ÿã¹ãŸ", s:"é£Ÿç‰©ç¹Šç¶­ã‚’æ„è­˜ã—ã¦ãã®ã“ã‚’é£Ÿã¹ãŸ"},
            {id:6, t:"ãŸã‚“ã±ãè³ªï¼ˆæ‰‹ã®ã²ã‚‰å¤§ï¼‰", s:"è‚‰ãƒ»é­šãƒ»åµãƒ»è±†é¡ã‚’åšã¿åˆ†é£Ÿã¹ãŸ"},
            {id:7, t:"ç‰¹ã«ã€Œé­šã€ã‚’é£Ÿã¹ãŸ", s:"è‚‰é¡ã ã‘ã§ãªãé­šã‚’æ‘‚å–ã—ãŸ"},
            {id:8, t:"å‘³å™Œæ±ã‚’é£²ã‚“ã ", s:"1æ—¥1å›ä»¥ä¸Šã®ç™ºé…µé£Ÿå“è£œçµ¦"},
            {id:9, t:"ç©ºè…¹æ„Ÿã®æ„è­˜", s:"ãŠè…¹ãŒç©ºã„ã¦ã‹ã‚‰é£Ÿäº‹ã‚’å§‹ã‚ãŸ"},
            {id:10, t:"ä¸€å£30å›ã‚ˆãå™›ã‚“ã ", s:"ä¸å¯§ã«å’€åš¼ã—ã¦æ¶ˆåŒ–ã‚’åŠ©ã‘ãŸ"}
        ];
        const minusList = [
            {id:11, t:"å°éº¦è£½å“(æ¸›ç‚¹)", s:"ãƒ‘ãƒ³ã€éººé¡ã€ãƒ‘ã‚¹ã‚¿ãªã©ã®æ‘‚å–"},
            {id:12, t:"ç²¾è£½ç³–(æ¸›ç‚¹)", s:"ç”˜ã„ãŠè“å­ã€ã‚¸ãƒ¥ãƒ¼ã‚¹ãªã©ã®æ‘‚å–"},
            {id:13, t:"æšã’ç‰©(æ¸›ç‚¹)", s:"è¡£ã®ã¤ã„ãŸæšã’ç‰©ã€æ²¹ã®å¤šã„é£Ÿäº‹"},
            {id:14, t:"ãŠé…’ãƒ»ã‚«ãƒ•ã‚§ã‚¤ãƒ³(æ¸›ç‚¹)", s:"3æ¯ä»¥ä¸Šã®ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã‚„ã‚³ãƒ¼ãƒ’ãƒ¼ç­‰"}
        ];

        const render = (list, target, color) => {
            list.forEach(q => {
                document.getElementById(target).innerHTML += `
                    <div class="q-card" style="background:${color}">
                        <div class="q-text">Q${q.id}. ${q.t} <span class="q-sub">${q.s}</span></div>
                        <input type="checkbox" name="Q${q.id}" class="q-check">
                    </div>`;
            });
        };
        render(plusList, 'plusQs', '#e8f5e9'); render(minusList, 'minusQs', '#fff3e0');

        document.getElementById('dailyForm').onsubmit = async (e) => {
            e.preventDefault();
            document.getElementById('loading').style.display = 'flex';
            const formData = new FormData(e.target);
            formData.append('user_id', userId);

            try {
                // é€ä¿¡ã€‚Netlify Functionã®ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                const res = await fetch('/.netlify/functions/daily-submit', { method: 'POST', body: formData });
                const data = await res.json();
                
                // ã€çµæœãŒå‡ºãªã„ä¸å…·åˆã®ä¿®æ­£ã€‘
                // data.log_id ãŒè¿”ã£ã¦ããŸã‚‰çµæœãƒšãƒ¼ã‚¸ã¸ã€‚
                // å¿µã®ãŸã‚ log_id ãŒãªãã¦ã‚‚æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã¾ã™
                if (data.log_id || res.ok) {
                    const logId = data.log_id || "latest";
                    window.location.href = `/result?log_id=${logId}&user_id=${userId}`;
                } else {
                    alert("ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™ã€‚");
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (err) {
                document.getElementById('loading').style.display = 'none';
                alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†™çœŸã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã‹ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
            }
        };
    </script>
</body>
</html>
