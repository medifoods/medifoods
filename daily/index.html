<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>ä»Šã®è¨˜éŒ² | é£Ÿè–¬AI</title>
    <style>
        :root { --main: #4a6741; --bg: #fdfaf1; --plus: #e8f5e9; --minus: #fff3e0; }
        body { font-family: "Hiragino Sans", sans-serif; background: var(--bg); padding: 15px; color: #333; }
        .container { max-width: 550px; margin: auto; background: white; padding: 30px; border-radius: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        .char-box { text-align: center; background: #f9fbf8; padding: 20px; border-radius: 30px; border: 2px solid #eef2ed; margin-bottom: 25px; }
        h1 { color: var(--main); text-align: center; font-size: 1.6rem; margin-bottom: 10px; }
        .sub-desc { text-align: center; font-size: 0.9rem; color: #666; margin-bottom: 25px; }
        /* è³ªå•ã‚«ãƒ¼ãƒ‰ï¼šè¦–èªæ€§é‡è¦– */
        .q-card { display: flex; align-items: center; justify-content: space-between; padding: 18px; margin: 10px 0; border-radius: 15px; border: 1px solid #eee; }
        .q-text { flex: 1; font-size: 1.2rem; font-weight: bold; }
        .q-check { width: 40px; height: 40px; transform: scale(1.6); accent-color: var(--main); }
        .btn-submit { background: var(--main); color: white; width: 100%; padding: 25px; border-radius: 20px; border: none; font-weight: bold; font-size: 1.6rem; cursor: pointer; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="char-box"><span style="font-size:60px;">ğŸ¦</span><p style="font-weight:bold; color:var(--main);">ä»Šã®å†…å®¹ã‚’æ•™ãˆã¦ã­ï¼</p></div>
        <h1>ğŸ´ ä»Šã®é£Ÿè–¬è¨˜éŒ²</h1>
        <p class="sub-desc">â€»ä¸€æ—¥ã®ä¸­ã§é£Ÿã¹ãŸã‚‚ã®ã‚’ãã®éƒ½åº¦ç™»éŒ²ã§ãã¾ã™ã€‚<br>ä»Šæ—¥ã®åˆè¨ˆã¨ã—ã¦ç´¯è¨ˆè¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>
        
        <form id="dailyForm">
            <!-- ç›®çš„ãƒ»å†™çœŸï¼ˆå…¨ã‚¹ãƒšãƒƒã‚¯ç¶­æŒï¼‰ -->
            <label style="font-weight:bold; color:var(--main);">ğŸ½ï¸ é£Ÿäº‹ã®ç›®çš„</label>
            <select name="meal_purpose" required style="width:100%; padding:15px; border-radius:12px; font-size:1.2rem; margin-bottom:20px;">
                <option value="health">ä½“ã‚’æ•´ãˆã‚‹ï¼ˆå¥åº·ï¼‰</option>
                <option value="enjoy">æ™‚é–“ã‚’æ¥½ã—ã‚€ï¼ˆå¹¸ç¦ï¼‰</option>
                <option value="social">äººã¨éã”ã™ï¼ˆäº¤æµï¼‰</option>
            </select>

            <label style="font-weight:bold; color:var(--main);">ğŸ“¸ å†™çœŸï¼ˆé£Ÿäº‹ãƒ»èˆŒï¼‰</label>
            <input type="file" name="photos" multiple required style="width:100%; margin-bottom:20px;">

            <!-- åŠ ç‚¹ãƒ»æ¸›ç‚¹ Q1-Q14ï¼ˆå®Œå…¨ç¶²ç¾…ï¼‰ -->
            <div id="questionsArea"></div>

            <button type="submit" class="btn-submit">è¨˜éŒ²ã‚’é€ä¿¡ã—ã¦è¨ºæ–­ã‚’è¦‹ã‚‹</button>
        </form>
    </div>

    <script>
        const userId = new URLSearchParams(window.location.search).get('user_id') || "U12345";
        const habits = [
            {id:1,t:"ãƒŠãƒƒãƒ„",c:"#e8f5e9"},{id:2,t:"é‡èœ",c:"#e8f5e9"},{id:3,t:"æ—¬ã®ç‰©",c:"#e8f5e9"},{id:4,t:"æµ·è—»",c:"#e8f5e9"},
            {id:5,t:"ã‚­ãƒã‚³",c:"#e8f5e9"},{id:6,t:"ãŸã‚“ã±ãè³ª",c:"#e8f5e9"},{id:7,t:"é­š",c:"#e8f5e9"},{id:8,t:"å‘³å™Œæ±",c:"#e8f5e9"},
            {id:9,t:"ç©ºè…¹æ„Ÿ",c:"#e8f5e9"},{id:10,t:"ã‚ˆãå™›ã‚“ã ",c:"#e8f5e9"},{id:11,t:"å°éº¦è£½å“(æ¸›ç‚¹)",c:"#fff3e0"},
            {id:12,t:"ç”˜ã„ç‰©(æ¸›ç‚¹)",c:"#fff3e0"},{id:13,t:"æšã’ç‰©(æ¸›ç‚¹)",c:"#fff3e0"},{id:14,t:"ãŠé…’/ã‚«ãƒ•ã‚§ã‚¤ãƒ³(æ¸›ç‚¹)",c:"#fff3e0"}
        ];
        habits.forEach(q => {
            document.getElementById('questionsArea').innerHTML += `<div class="q-card" style="background:${q.c}"><span class="q-text">Q${q.id}. ${q.t}ã‚’æ‘‚ã£ãŸ</span><input type="checkbox" name="Q${q.id}" class="q-check"></div>`;
        });

        document.getElementById('dailyForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = "è¨ºæ–­ä¸­..."; btn.disabled = true;

            const formData = new FormData(e.target);
            formData.append('user_id', userId);

            try {
                const res = await fetch('/.netlify/functions/daily-submit', { method: 'POST', body: formData });
                const data = await res.json();
                // ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼šé€ä¿¡æˆåŠŸå¾Œã€ç¢ºå®Ÿã«çµæœãƒšãƒ¼ã‚¸ã¸é·ç§»ã•ã›ã‚‹ [3, 4]
                window.location.href = `/result?log_id=${data.log_id}&user_id=${userId}`;
            } catch (err) {
                alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼ã€‚é€šä¿¡ç’°å¢ƒã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                btn.innerText = "è¨˜éŒ²ã‚’é€ä¿¡ã—ã¦è¨ºæ–­ã‚’è¦‹ã‚‹"; btn.disabled = false;
            }
        };
    </script>
</body>
</html>
