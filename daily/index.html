<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¨˜éŒ² | é£Ÿè–¬AI</title>
    <style>
        :root { --main: #4a6741; --bg: #fdfaf1; }
        body { font-family: "Hiragino Sans", sans-serif; background: var(--bg); padding: 15px; color: #333; }
        .container { max-width: 550px; margin: auto; background: white; padding: 30px; border-radius: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        .char-box { text-align: center; background: #f9fbf8; padding: 20px; border-radius: 30px; border: 2px solid #eef2ed; margin-bottom: 25px; }
        .char-img { font-size: 80px; }
        h1 { color: var(--main); text-align: center; font-size: 1.8rem; }
        label { font-weight: bold; color: var(--main); display: block; margin: 25px 0 10px; font-size: 1.3rem; }
        select, input[type="file"], input[type="range"] { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #eee; font-size: 1.2rem; margin-bottom: 15px; box-sizing: border-box; }
        .q-card { border-bottom: 1px solid #f0f0f0; padding: 15px 0; display: flex; align-items: center; justify-content: space-between; }
        .q-text { flex: 1; font-size: 1.1rem; }
        .q-check { width: 40px; height: 40px; transform: scale(1.6); accent-color: var(--main); }
        .stat-label { display: flex; justify-content: space-between; font-size: 1rem; color: #666; margin-top: -5px; }
        .btn-submit { background: var(--main); color: white; width: 100%; padding: 25px; border-radius: 20px; border: none; font-weight: bold; font-size: 1.6rem; cursor: pointer; margin-top: 30px; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 2000; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>
    <div id="loading" class="loading-overlay">
        <div style="font-size: 60px;">ğŸ¦</div>
        <p style="font-weight: bold; color: #4a6741; font-size: 1.5rem;">AIãŒã˜ã£ãã‚Šè¨ºå¯Ÿä¸­...</p>
        <p>â€»å†™çœŸãŒå¤§ãã™ãã‚‹ã¨æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™</p>
    </div>

    <div class="container">
        <div class="char-box"><span id="displayChar" class="char-img">ğŸ¦</span><p style="font-weight:bold; color:var(--main);">ä»Šæ—¥ã®ã‚ãªãŸã‚’æ•™ãˆã¦ã­</p></div>
        <h1>ğŸ´ ä»Šæ—¥ã®é£Ÿè–¬è¨˜éŒ²</h1>
        <form id="dailyForm">
            <label>ğŸ½ï¸ é£Ÿäº‹ã®ç›®çš„</label>
            <select name="meal_purpose" required>
                <option value="health">ä½“ã‚’æ•´ãˆã‚‹ï¼ˆå¥åº·ï¼‰</option>
                <option value="enjoy">æ™‚é–“ã‚’æ¥½ã—ã‚€ï¼ˆå–œã³ï¼‰</option>
                <option value="social">äººã¨éã”ã™ï¼ˆäº¤æµï¼‰</option>
            </select>

            <label>ğŸ“¸ å†™çœŸï¼ˆé£Ÿäº‹ãƒ»èˆŒï¼‰</label>
            <input type="file" name="photos" accept="image/*" multiple required>

            <label>âœï¸ ä»Šæ—¥ã®ç¿’æ…£ï¼ˆQ1ã€œQ14ï¼‰</label>
            <div id="habitQuestions"></div>

            <label>ğŸŒ¡ï¸ ä»Šæ—¥ã®ä½“èª¿ãƒ»å¿ƒï¼ˆå„10æ®µéšï¼‰</label>
            <div class="stat-group">
                <span>å¿ƒã®çŠ¶æ…‹ (1:æ‚ªã„ ã€œ 10:è‰¯ã„)</span>
                <input type="range" name="mind_state" min="1" max="10" value="5">
                <div class="stat-label"><span>æœ€æ‚ª</span><span>æ™®é€š</span><span>æœ€é«˜</span></div>
                
                <br><span>ä½“ã®çŠ¶æ…‹ (1:æ‚ªã„ ã€œ 10:è‰¯ã„)</span>
                <input type="range" name="body_state" min="1" max="10" value="5">
                <div class="stat-label"><span>æœ€æ‚ª</span><span>æ™®é€š</span><span>æœ€é«˜</span></div>
            </div>

            <label>ğŸš½ ä¾¿ãƒ»å°¿ãƒ»ç¡çœ ã®ãƒã‚§ãƒƒã‚¯</label>
            <select name="stool_state"><option value="è‰¯å¥½">ğŸ’© ä¾¿ã®çŠ¶æ…‹ï¼šã‚¹ãƒƒã‚­ãƒª</option><option value="ç¡¬ã„">ä¾¿ã®çŠ¶æ…‹ï¼šã‚³ãƒ­ã‚³ãƒ­ãƒ»ç¡¬ã„</option><option value="ç·©ã„">ä¾¿ã®çŠ¶æ…‹ï¼šãƒ‰ãƒ­ãƒ‰ãƒ­ãƒ»ç·©ã„</option></select>
            <select name="urine_state"><option value="æ­£å¸¸">ğŸ’§ å°¿ã®è‰²ï¼šé€æ˜ã€œæ·¡é»„è‰²</option><option value="æ¿ƒã„">å°¿ã®è‰²ï¼šæ¿ƒã„ï¼ˆæ°´åˆ†ä¸è¶³ï¼‰</option></select>
            <select name="sleep_quality"><option value="è‰¯å¥½">ğŸ˜´ ç¡çœ ï¼šãã£ã™ã‚Š</option><option value="æµ…ã„">ç¡çœ ï¼šä½•åº¦ã‚‚ç›®ãŒè¦šã‚ãŸ</option><option value="ä¸è¶³">ç¡çœ ï¼šæ™‚é–“ãŒè¶³ã‚Šãªã„</option></select>

            <button type="submit" class="btn-submit">è¨˜éŒ²ã‚’é€ä¿¡ã—ã¦è¨ºæ–­ã¸</button>
        </form>
    </div>

    <script>
        const userId = new URLSearchParams(window.location.search).get('user_id') || "U12345";
        const charList = ["ğŸ¦","ğŸ°","ğŸ»","ğŸ¼","ğŸ¶","ğŸ±","ğŸ¨","ğŸ¢","ğŸ¥","ğŸ‘»"];
        const habits = ["ãƒŠãƒƒãƒ„","é‡èœ","æ—¬ã®ç‰©","æµ·è—»","ã‚­ãƒã‚³","ãŸã‚“ã±ãè³ª","é­š","å‘³å™Œæ±","ç©ºè…¹æ„Ÿ","ã‚ˆãå™›ã‚“ã ","å°éº¦è£½å“(æ¸›ç‚¹)","ç”˜ã„ç‰©(æ¸›ç‚¹)","æšã’ç‰©(æ¸›ç‚¹)","ãŠé…’(æ¸›ç‚¹)"];
        
        habits.forEach((q, i) => {
            document.getElementById('habitQuestions').innerHTML += `<div class="q-card"><span class="q-text">Q${i+1}. ${q}</span><input type="checkbox" name="Q${i+1}" class="q-check"></div>`;
        });

        document.getElementById('dailyForm').onsubmit = async (e) => {
            e.preventDefault();
            document.getElementById('loading').style.display = 'flex';
            const formData = new FormData(e.target);
            formData.append('user_id', userId);
            try {
                const res = await fetch('/.netlify/functions/daily-submit', { method: 'POST', body: formData });
                const data = await res.json();
                window.location.href = `/result?log_id=${data.log_id}&user_id=${userId}`;
            } catch (err) {
                document.getElementById('loading').style.display = 'none';
                alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚å†™çœŸã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
            }
        };
    </script>
</body>
</html>
