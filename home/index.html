<script>
    window.onload = async () => {
        try {
            const res = await fetch(`/.netlify/functions/get-summary?user_id=${userId}`);
            const data = await res.json();
            
            // データがない（初日）場合の自然な出し分け
            document.getElementById('weekDisplay').innerText = `第 ${data.week_no || 1} 週目`;
            document.getElementById('yesterdayScore').innerText = data.y_base !== null ? data.y_base : "記録待機中";
            document.getElementById('totalAvg').innerText = data.base_avg_all > 0 ? parseFloat(data.base_avg_all).toFixed(1) : "明日から反映";
            
            // 今週の学び（初日は1週目の定型文を表示） [6]
            document.getElementById('learningPoint').innerText = data.weekly_learning_text || "まずは自分の現状を知ることから始めましょう。";
        } catch (e) {
            document.getElementById('learningPoint').innerText = "あなたの食薬習慣をここからサポートします。";
        }
    };
</script>
