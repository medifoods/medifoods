<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>ä»Šé€±ã®ãµã‚Šè¿”ã‚Š | é£Ÿè–¬AI</title>
    <style>
        :root { --main: #4a6741; --bg: #fdfaf1; }
        body { font-family: "Hiragino Sans", sans-serif; background: var(--bg); padding: 20px; color: #333; }
        .container { max-width: 550px; margin: auto; background: white; padding: 30px; border-radius: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ */
        .char-box { text-align: center; margin-bottom: 30px; padding: 20px; background: #f9fbf8; border-radius: 25px; }
        .char-img { font-size: 80px; display: block; margin-bottom: 10px; } /* ã‚­ãƒ£ãƒ©ç”»åƒä»£ã‚ã‚Šã«å·¨å¤§çµµæ–‡å­— */
        .char-msg { font-size: 1.2rem; font-weight: bold; color: var(--main); line-height: 1.5; }
        
        h1 { color: var(--main); text-align: center; font-size: 1.8rem; }
        .section-title { font-size: 1.4rem; font-weight: bold; color: var(--main); border-left: 8px solid var(--main); padding-left: 15px; margin: 30px 0 15px; }
        
        /* é€±æœ«å•è¨º A-J */
        .q-row { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; }
        .q-label { font-size: 1.2rem; flex: 1; }
        .q-select { padding: 10px; font-size: 1.1rem; border-radius: 10px; border: 1px solid #ccc; width: 80px; }

        .btn-submit { background: var(--main); color: white; width: 100%; padding: 25px; border-radius: 20px; border: none; font-weight: bold; font-size: 1.5rem; cursor: pointer; margin-top: 30px; box-shadow: 0 8px 20px rgba(74,103,65,0.2); }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç™»å ´ã‚¨ãƒªã‚¢ -->
        <div class="char-box">
            <span id="charImg" class="char-img">ğŸŒ¿</span> <!-- ã“ã“ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ£ãƒ© -->
            <p id="charMsg" class="char-msg">ä»Šé€±ã‚‚ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸã­ï¼<br>ä½“èª¿ã«åˆã‚ã›ã¦ã€æ¥é€±ã®ãƒ—ãƒ©ãƒ³ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚</p>
        </div>

        <h1>ğŸ“Š ä»Šé€±ã®ç©ã¿é‡ã­</h1>

        <!-- é€±æœ«å•è¨ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ—¥æ›œæ—¥ã®ã¿è¡¨ç¤ºï¼‰ -->
        <div id="weeklyFormSection" class="hidden">
            <div class="section-title">é€±æœ«ã®ä½“èª¿ãƒã‚§ãƒƒã‚¯</div>
            <p style="font-size: 1.1rem; color: #666; margin-bottom: 20px;">ä»¥ä¸‹ã®ç—‡çŠ¶ãŒä»Šé€±ã©ã‚Œãã‚‰ã„ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ<br>(0:ãªã— ã€œ 3:å¤šã„)</p>
            <form id="weeklyQuestionForm">
                <!-- A-E: æ¶ˆåŒ–å™¨ãƒ»ä»£è¬ç³» -->
                <div class="q-row"><span class="q-label">A. èƒƒã‚‚ãŸã‚Œãƒ»é£Ÿæ¬²ä¸æŒ¯</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">B. ã‚€ãã¿ãƒ»ä½“ãŒé‡ã„</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">C. ä¾¿ç§˜ã¾ãŸã¯ä¸‹ç—¢</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">D. è‚Œè’ã‚Œãƒ»å¹ãå‡ºç‰©</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">E. æœã€ã™ã£ãã‚Šèµ·ãã‚Œãªã„</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <!-- F-J: ç²¾ç¥ãƒ»ç¡çœ ãƒ»è¡€æµç³» -->
                <div class="q-row"><span class="q-label">F. ã‚¤ãƒ©ã‚¤ãƒ©ãƒ»ä¸å®‰æ„Ÿ</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">G. å¯ã¤ããŒæ‚ªã„ãƒ»çœ ã‚ŠãŒæµ…ã„</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">H. è‚©ã“ã‚Šãƒ»é ­ç—›</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">I. ç›®ã®ç–²ã‚Œãƒ»ãƒ‰ãƒ©ã‚¤ã‚¢ã‚¤</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                <div class="q-row"><span class="q-label">J. è¶³è…°ã®å†·ãˆãƒ»ç–²ã‚Œ</span><input type="number" name="A" min="0" max="3" value="0" class="q-select"></div>
                
                <button type="submit" class="btn-submit">AIè¨ºæ–­ã‚’ç”Ÿæˆã™ã‚‹</button>
            </form>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆå•è¨ºå¾Œã«å‡ºç¾ï¼‰ -->
        <div id="weeklyResult" class="hidden">
            <div class="section-title">æ¥é€±ã®é£Ÿè–¬ãƒ—ãƒ©ãƒ³</div>
            <div id="planContent" style="font-size: 1.2rem; line-height: 1.8;"></div>
        </div>
    </div>

    <script>
        const userId = new URLSearchParams(window.location.search).get('user_id') || "U12345";
        
        window.onload = async () => {
            const res = await fetch(`/.netlify/functions/get-summary?user_id=${userId}`);
            const data = await res.json();

            // 1. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ›´æ–°
            if (data.char_status_logic === "NORMAL") {
                document.getElementById('charImg').innerText = "ğŸŒ¿"; // æ™®é€šã®ã‚­ãƒ£ãƒ©
            }

            // 2. æ—¥æ›œæ—¥ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã¾ãŸã¯å•è¨ºãŒå¿…è¦ãªé€±ã®çµ‚ã‚ã‚Šï¼‰
            const today = new Date();
            if (today.getDay() === 0) { // 0ã¯æ—¥æ›œæ—¥
                document.getElementById('weeklyFormSection').classList.remove('hidden');
            }
        };
    </script>
</body>
</html>

--------------------------------------------------------------------------------
2. ã€APIã€‘ netlify/functions/get-summary.js ã®ä¿®æ­£
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ã€æ—¥æ›œæ—¥ã®åˆ¤å®šãƒ•ãƒ©ã‚°ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«æ­£ã—ãæ¸¡ã™ã‚ˆã†ã«å¼·åŒ–ã—ã¾ã—ãŸã€‚
const { GoogleSpreadsheet } = require('google-spreadsheet');

exports.handler = async (event) => {
    const userId = event.queryStringParameters.user_id || "U12345";
    try {
        const doc = new GoogleSpreadsheet(process.env.SPREADSHEET_ID);
        const privateKey = process.env.GOOGLE_PRIVATE_KEY.replace(/\\n/gm, '\n');
        await doc.useServiceAccountAuth({ client_email: process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL, private_key: privateKey });
        await doc.loadInfo();

        const aggSheet = doc.sheetsByTitle['Agg'];
        const rows = await aggSheet.getRows();
        const userAgg = rows.find(r => r.user_id === userId);

        if (!userAgg) throw new Error("User Not Found");

        return {
            statusCode: 200,
            headers: { "Content-Type": "application/json", "Access-Control-Allow-Origin": "*" },
            body: JSON.stringify({
                week_no: userAgg.current_week_no || 1,
                weekly_learning_text: userAgg.weekly_learning_text || "",
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¿”ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯NORMAL [1]ï¼‰
                char_status_logic: userAgg.char_status_logic || "NORMAL"
            })
        };
    } catch (error) {
        return { statusCode: 500, body: JSON.stringify({ error: error.message }) };
    }
};
