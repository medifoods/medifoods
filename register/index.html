<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆæœŸç™»éŒ² | é£Ÿè–¬AI</title>
    <style>
        :root { --main: #4a6741; --bg: #fdfaf1; }
        body { font-family: sans-serif; background: var(--bg); padding: 15px; color: #333; line-height: 1.5; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        h1 { color: var(--main); text-align: center; font-size: 1.4rem; margin: 10px 0; }
        label { display: block; margin-top: 15px; font-weight: bold; color: var(--main); font-size: 0.95rem; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; background: var(--main); color: white; padding: 18px; border: none; border-radius: 15px; margin-top: 30px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .hint { font-size: 0.75rem; color: #888; margin-top: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align:center; font-size: 50px;">ğŸ¦</div>
        <h1>ã¯ã˜ã‚ã¦ã®é£Ÿè–¬ç™»éŒ²</h1>
        <p style="text-align:center; font-size:0.85rem; color:#666;">ã‚ãªãŸã®ä½“è³ªã«åˆã‚ã›ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æº–å‚™ã—ã¾ã™ã€‚</p>
        
        <form id="regForm">
            <label>ãŠåå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å¯ï¼‰</label>
            <input type="text" name="display_name" required placeholder="ä¾‹ï¼šãƒ©ã‚¤ã‚ªãƒ³ã•ã‚“">

            <label>ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ / ä¼šç¤¾åï¼ˆä»»æ„ï¼‰</label>
            <input type="text" name="group_code" placeholder="ä¾‹ï¼šSHOP001">
            <p class="hint">â€»ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚ºã‚³ãƒ¼ãƒ‰ç­‰ãŒã‚ã‚‹å ´åˆã¯å…¥åŠ›ã—ã¦ãã ã•ã„</p>

            <label>æ€§åˆ¥</label>
            <select name="gender">
                <option value="å¥³æ€§">å¥³æ€§</option><option value="ç”·æ€§">ç”·æ€§</option><option value="ãã®ä»–">ãã®ä»–</option>
            </select>

            <label>ç”Ÿå¹´æœˆæ—¥</label>
            <input type="date" name="birth_date" required>

            <label>ğŸš€ é£Ÿè–¬ã‚¹ã‚¿ãƒ¼ãƒˆæ—¥</label>
            <input type="date" name="start_date" id="start_date_input" required>
            <p class="hint">â€»ä»Šæ—¥ã‹ã‚‰é–‹å§‹ã™ã‚‹å ´åˆã¯ãã®ã¾ã¾ã§OK</p>

            <label>ä»Šã®ãŠæ‚©ã¿ï¼ˆä½“èª¿ãªã©ï¼‰</label>
            <textarea name="notes" rows="2" placeholder="ä¾‹ï¼šç–²ã‚Œã‚„ã™ã„ã€ã‚€ãã¿ã€å†·ãˆæ€§ãªã©"></textarea>

            <button type="submit" class="btn">ç™»éŒ²ã‚’å®Œäº†ã—ã¦ã¯ã˜ã‚ã‚‹ï¼</button>
        </form>
    </div>

    <script>
        document.getElementById('start_date_input').valueAsDate = new Date();

        document.getElementById('regForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = "ç™»éŒ²æƒ…å ±ã‚’é€ä¿¡ä¸­..."; btn.disabled = true;

            const formData = new FormData(e.target);
            // æœ¬æ¥ã¯LINE UIDã€‚ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
            const userId = "U" + Math.floor(100000 + Math.random() * 900000); 
            formData.append('user_id', userId);

            try {
                const res = await fetch('/.netlify/functions/user-register', {
                    method: 'POST',
                    body: new URLSearchParams(formData)
                });
                
                if (res.ok) {
                    alert("ğŸ¦ ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼\nãƒ›ãƒ¼ãƒ ç”»é¢ã¸ç§»å‹•ã—ã¾ã™ã€‚");
                    window.location.href = `/home/?user_id=${userId}`;
                } else { throw new Error(); }
            } catch (err) {
                alert("ç™»éŒ²ã‚¨ãƒ©ãƒ¼ã€‚ãƒãƒƒãƒˆç’°å¢ƒã‚„è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                btn.innerText = "ç™»éŒ²ã‚’å®Œäº†ã—ã¦ã¯ã˜ã‚ã‚‹ï¼"; btn.disabled = false;
            }
        };
    </script>
</body>
</html>
